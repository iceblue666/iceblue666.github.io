\-\-\-
title:开发博客的问题和解决方案
time:2021-03-08 14:49:00
categories:前端,博客
tags:前端,博客,问题
summary:开发本博客遇到的一些耗时长的问题和解决的方案
\-\-\-

# 开发博客的问题和解决方案

## 1. 怎么解决文件查找

用require.context遍历整个文件夹

```
const filesMD = require.context('/public/reso', true, /\.md$/);
const filesMDNames = filesMD.keys(); //fileMDNames就是路径
```

## 2. 怎么解决md文件读入

用mock，和axios，发现axios不仅可以读网络资源，也可以读文件

方便可扩展，如果后面接着写后端，直接不用改前端

public默认会打包所有进去，但是浏览器source显示

## 3. 怎么解决md文件的解析

用vue-markdown组件

github-markdown-css作为样式

highlight.js代码高亮

## 4. mock

mock本身是通过匹配路径来拦截返回相应的数据

但当有前缀相同的匹配规则时会有问题，比如

两个mock规则 `mock('/^article')`和`mock('/^articleDetail')`

就会发现articleDetail请求数据错误，返回的都是article的数据

## 5. 自制文件系统

```javascript
// tempListDatas是一群路径
ExtractFileSystem(tmepListDatas)
const fileSystem = createNode('reso',true,[],{});

function createNode(name, isFolder, children = [], info = {}){
  let newNode = {};
  newNode.name = name;
  newNode.isFolder = isFolder;
  newNode.children = children;
  newNode.info = info;
  return newNode;
}

// arr是当前还没有安进去的路径数组，node是对象点，info是要填的节点信息
function buildFileSystemTree(arr, node, info){
  if(arr.length === 1) {
    let newnode = createNode(arr[0].replace('.md', ''), false, [], info);
    node.children.push(newnode);
    return;
  }
  else {
    let nextnode = null;
    for(let it of node.children){
      if(it.name === arr[0]){
        nextnode = it;break;
      }
    }
    if(nextnode){
      arr.shift()
      buildFileSystemTree([...arr], nextnode, info);
    }
    else {
      nextnode = createNode(arr[0], true, [], {});
      arr.shift();
      node.children.push(nextnode);
      buildFileSystemTree([...arr], nextnode, info);
    }
  }
}

```
## 6.怎么限制摘要的行数

```
  display: -webkit-box;
  text-overflow: ellipsis;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 6;
  word-break: break-all;
  overflow: hidden;
```

## 7. 怎么取摘要

结合6，目前是直接把所有这个博客的内容扔进去，同时由于这是md格式文本，所以先replace一下，把`#` `*`等替换掉。

## 8. gitPage无法更新

在确定一篇博客的模板格式后，发现gitPage构建报错了。

看了这篇文章后https://www.jianshu.com/p/938ec18e572a，觉得应该和我的问题差不多，可能是jekyll不支持---这种形式的md，所以会报错，暂行办法就是把-加转义\，长久之计是自己买服务器就没有这个检查了。

[21:52] 又思考了一下，觉得不对。可以不用服务器，用node写个脚本，把信息存进一个js里面，还可以在这个里面写一些方法，这样就在本地加载好了所有信息，不用上传md文件，自然不用gitpage的检查，还能优化性能，省下运行代码的时间。本质没有变，都是要预处理，只不过这样就是等同build再多耗费时间，但别人在浏览器访问直接访问到数据。

## 9. windows写bat方便git push

```
// deploy.bat
cd iceblue666.github.io
git add .
git commit -m '博客更新'
git push origin master
```

要注意是ANSI而不是utf8，否则会中文乱码

## 10. 【已解决】slot中的text不响应

```
// index.vue
<cmp>{{ sth }}</cmp>
<input v-model="sth">
{{ sth }}
```

```
 // cmp.vue
 <div>
    <div>
      cmp组件
      {{ this.$slots.default }}
    </div>
</div>
```

**问题**：在index.vue中v-model随意改变，可以看到cmp.vue中this.$slots.default确实是一起改变的，但是并不能响应。

**尝试解决方案**：

1. this.$set() 【失败】
2. watch $slots deep:true 【失败】
3. this.$forceUpdate()
4. this.$slots.default[0].text 【成功】

**推测**：text应该是在Vue考虑中太小了，不值得响应，否则整个花销会很大，或者是在编写Vue的时候没有考虑，而后续改的代价高就改不了，毕竟一般不会有人这么用，而且不这么用也有其他方法解决，比如绑定props上。

**结果**：自己犯蠢，明明打印出来了是个数组，不仔细看，菜这一个字都顶到脑门上了！

## 11. 【未解决】SEO检索

github不支持